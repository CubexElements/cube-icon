<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-tooltip/paper-tooltip.html">
<link rel="import" href="../fort-behavior/fort-text-content-behavior.html">

<!--
An element providing a solution to no problem in particular.

Example:

    <fort-icon></fort-icon>

Example:

    <fort-icon>
      <h2>Hello fort-icon</h2>
    </fort-icon>

@demo demo/index.html
@hero hero.svg
-->

<dom-module id="fort-icon" attributes="icon src size alt color background">
  <template strip-whitespace>
    <style>
      :host {
        display: inline-flex;
        line-height: normal;
        box-sizing: content-box;
        border-color: var(--fort-icon-background-color);
        background-color: var(--fort-icon-background-color);
        color: var(--fort-icon-color);
        padding: 5px;
        width: var(--fort-icon-size, 24px);
        height: var(--fort-icon-size, 24px);
      }

      :host ::slotted(svg) {
        fill: currentColor;
      }

      :host iron-icon {
        display: block;
        width: 100%;
        height: 100%;
      }
    </style>

    <template is="dom-if" if="[[_showIcon(icon,src)]]">
      <iron-icon icon="[[icon]]" src="[[src]]"></iron-icon>
    </template>

    <slot></slot>

    <template is="dom-if" if="[[alt]]">
      <paper-tooltip>[[alt]]</paper-tooltip>
    </template>
  </template>

  <script>
    Polymer(
      {
        is:            'fort-icon',
        properties:    {
          icon:       {
            type:               String,
            reflectToAttribute: true,
            observer:           '_iconChanged'
          },
          src:        {
            type:               String,
            reflectToAttribute: true
          },
          alt:        {type: String, value: ''},
          size:       {
            type:     Number,
            observer: '_styleChanged'
          },
          color:      {
            type:     String,
            value:    '',
            observer: '_styleChanged'
          },
          background: {
            type:     String,
            value:    '',
            observer: '_styleChanged'
          }
        },
        attached:      function ()
                       {
                         if(this.getEffectiveChildren().length > 0)
                         {
                           // strip width/height from svg to allow it to scale to [[size]]
                           var svg = this.queryEffectiveChildren('svg');
                           if(svg)
                           {
                             svg.style.width = '100%';
                             svg.style.height = '100%';

                             if(svg.hasAttribute('width'))
                             {
                               svg.removeAttribute('width');
                             }

                             if(svg.hasAttribute('height'))
                             {
                               svg.removeAttribute('height');
                             }
                           }
                         }
                       },
        _styleChanged: function ()
                       {
                         var props = {
                           '--fort-icon-background-color': this.background,
                           '--fort-icon-color':            this.color
                         };
                         if(this.size)
                         {
                           props['--fort-icon-size'] = this.size + 'px';
                         }
                         this.updateStyles(props);
                       },
        _iconChanged:  function ()
                       {
                         if(this.icon)
                         {
                           var iconSplit = this.icon.split(':');
                           var iconGroup = iconSplit[0] == 'icons' ? 'iron' : iconSplit[0];
                           this.importHref(this.resolveUrl('../iron-icons/' + iconGroup + '-icons.html'));
                         }
                       },
        _showIcon:     function (icon, src)
                       {
                         return icon || src;
                       },

        behaviors: [Polymer.FortTextContentBehavior]
      }
    );
  </script>
</dom-module>
