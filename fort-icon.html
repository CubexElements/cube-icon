<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-tooltip/paper-tooltip.html">
<link rel="import" href="../fort-behavior/fort-text-content-behavior.html">

<!--
An element providing a solution to no problem in particular.

Example:

    <fort-icon></fort-icon>

Example:

    <fort-icon>
      <h2>Hello fort-icon</h2>
    </fort-icon>

@demo demo/index.html
@hero hero.svg
-->

<dom-module id="fort-icon" attributes="icon src size alt color background">
  <template strip-whitespace>
    <style>
      :host {
        --fort-icon-size: 24px;
        --iron-icon-width: var(--fort-icon-size, 24px);
        --iron-icon-height: var(--fort-icon-size, 24px);

        width: var(--fort-icon-size, 24px);
        height: var(--fort-icon-size, 24px);
        display: inline-flex;
        line-height: normal;
        border-color: var(--fort-icon-background-color);
        background-color: var(--fort-icon-background-color);
        color: var(--fort-icon-color);
      }

      :host ::content svg {
        fill: currentColor;
      }

      i {
        font-size: var(--fort-icon-size, 24px);
      }
    </style>

    <template is="dom-if" if="[[icon]]">
      <iron-icon icon="[[icon]]"></iron-icon>
    </template>
    <template is="dom-if" if="[[src]]">
      <iron-icon src="[[src]]"></iron-icon>
    </template>

    <template is="dom-if" if="[[!icon]]">
      <slot></slot>
    </template>

    <template is="dom-if" if="[[alt]]">
      <paper-tooltip>[[alt]]</paper-tooltip>
    </template>
  </template>

  <script>
    Polymer(
      {
        is:                 'fort-icon',
        properties:         {
          icon:       {
            type:     String,
            value:    '',
            observer: '__updateProperties'
          },
          src:        {type: String},
          size:       {
            type:     Number,
            value:    24,
            observer: '_sizeChanged'
          },
          background: {
            type:     String,
            value:    '',
            observer: '_sizeChanged'
          },
          color:      {
            type:     String,
            value:    '',
            observer: '_sizeChanged'
          },
          alt:        {type: String}
        },
        _sizeChanged:       function ()
                            {
                              // remove any non-numeric characters, ready to append px for styles
                              var defaultSize = 24;
                              var newSize = this.size || defaultSize;
                              if(this.size !== newSize)
                              {
                                this.size = newSize;
                              }
                              this.updateStyles(
                                {
                                  '--fort-icon-size':             this.size + 'px',
                                  '--fort-icon-background-color': this.background,
                                  '--fort-icon-color':            this.color
                                }
                              );
                            },
        __updateProperties: function ()
                            {
                              if(this.getEffectiveChildren().length > 0)
                              {
                                // strip width/height from svg to allow it to scale to [[size]]
                                var svg = this.queryEffectiveChildren('svg');
                                if(svg)
                                {
                                  svg.style.width = '100%';
                                  svg.style.height = '100%';

                                  if(svg.hasAttribute('width'))
                                  {
                                    svg.removeAttribute('width');
                                  }

                                  if(svg.hasAttribute('height'))
                                  {
                                    svg.removeAttribute('height');
                                  }
                                }
                              }

                              if(this.icon)
                              {
                                var iconSplit = this.icon.split(':');
                                var iconGroup = iconSplit[0] == 'icons' ? 'iron' : iconSplit[0];
                                this.importHref(this.resolveUrl('../iron-icons/' + iconGroup + '-icons.html'));
                              }
                            },

        behaviors: [Polymer.FortTextContentBehavior]
      }
    );
  </script>
</dom-module>
