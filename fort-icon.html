<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-tooltip/paper-tooltip.html">

<!--
An element providing a solution to no problem in particular.

Example:

    <fort-icon></fort-icon>

Example:

    <fort-icon>
      <h2>Hello fort-icon</h2>
    </fort-icon>

@demo demo/index.html
@hero hero.svg
-->

<dom-module id="fort-icon" attributes="size alt color background">
  <style>
    :host {
      --fort-icon-size: 24px;
      --iron-icon-width: var(--fort-icon-size, 24px);
      --iron-icon-height: var(--fort-icon-size, 24px);

      width: var(--fort-icon-size, 24px);
      height: var(--fort-icon-size, 24px);
      display: inline-block;
      line-height: 1em;
      border-color: var(--fort-icon-background-color);
      background-color: var(--fort-icon-background-color);
      color: var(--fort-icon-color);
    }

    :host ::content svg {
      fill: currentColor;
    }

    i {
      font-size: var(--fort-icon-size, 24px);
    }
  </style>

  <template strip-whitespace>
    <content select="svg"></content>

    <template is="dom-if" if="{{_icon}}">
      <iron-icon icon="[[_icon]]"></iron-icon>
    </template>

    <template is="dom-if" if="{{_url}}">
      <iron-icon src="[[_url]]"></iron-icon>
    </template>

    <template is="dom-if" if="[[alt]]">
      <paper-tooltip>[[alt]]</paper-tooltip>
    </template>
  </template>

  <script>
    Polymer(
      {
        is:           'fort-icon',
        properties:   {
          size:       {
            type:     String,
            value:    '24',
            observer: '_sizeChanged'
          },
          background: {
            type:     String,
            value:    '24',
            observer: '_sizeChanged'
          },
          color:      {
            type:     String,
            value:    '24',
            observer: '_sizeChanged'
          },
          src:        String,
          alt:        String
        },
        _icon:        '',
        _url:         '',
        ready:        function ()
                      {
                        Polymer.dom(this).observeNodes(this._updateType);
                      },
        _sizeChanged: function ()
                      {
                        // remove any non-numeric characters, ready to append px for styles
                        var defaultSize = this.properties.size.value;
                        this.size = (this.size || defaultSize).replace(/\D/g, '') || defaultSize;

                        this.customStyle['--fort-icon-size'] = this.size + 'px';
                        this.customStyle['--fort-icon-background-color'] = this.background;
                        this.customStyle['--fort-icon-color'] = this.color;
                        this.updateStyles();
                      },
        _updateType:  function ()
                      {
                        this._icon = this._url = '';
                        if(this.getEffectiveChildren().length == 0)
                        {
                          var text = this.getEffectiveTextContent().trim();
                          if(text.indexOf('.') == -1)
                          {
                            this._icon = text;
                          }
                          else
                          {
                            this._url = text;
                          }
                        }
                        else
                        {
                          // strip width/height from svg to allow it to scale to [[size]]
                          var svg = this.queryEffectiveChildren('svg');
                          if(svg)
                          {
                            svg.style.width = '100%';
                            svg.style.height = '100%';

                            if(svg.hasAttribute('width'))
                            {
                              svg.removeAttribute('width');
                            }

                            if(svg.hasAttribute('height'))
                            {
                              svg.removeAttribute('height');
                            }
                          }
                        }

                        if(this._icon)
                        {
                          var iconSplit = this._icon.split(':');
                          var iconGroup = iconSplit[0] == 'icons' ? 'iron' : iconSplit[0];
                          this.importHref(this.resolveUrl('../iron-icons/' + iconGroup + '-icons.html'));
                        }
                      }
      }
    );
  </script>
</dom-module>
