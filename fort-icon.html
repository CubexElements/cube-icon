<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-tooltip/paper-tooltip.html">

<!--
An element providing a solution to no problem in particular.

Example:

    <fort-icon></fort-icon>

Example:

    <fort-icon>
      <h2>Hello fort-icon</h2>
    </fort-icon>

@demo demo/index.html
@hero hero.svg
-->

<dom-module id="fort-icon" attributes="size alt">
  <style>
    :host {
      --fort-icon-size: 24px;
      --iron-icon-width: var(--fort-icon-size, 24px);
      --iron-icon-height: var(--fort-icon-size, 24px);

      width: var(--fort-icon-size, 24px);
      height: var(--fort-icon-size, 24px);
      display: inline-block;
    }

    i {
      font-size: var(--fort-icon-size, 24px);
    }
  </style>

  <template>
    <template is="dom-if" if="{{_isType('svg')}}">
      <content select="svg"></content>
    </template>

    <template is="dom-if" if="{{_isType('iron')}}">
      <iron-icon icon="[[_icon]]"></iron-icon>
    </template>

    <template is="dom-if" if="{{_isType('url')}}">
      <iron-icon src="[[_icon]]"></iron-icon>
    </template>

    <template is="dom-if" if="{{_isType('material')}}">
      <i class="material-icons">[[_icon]]</i>
    </template>

    <template is="dom-if" if="[[alt]]">
      <paper-tooltip>[[alt]]</paper-tooltip>
    </template>
  </template>

  <script>
    Polymer(
      {
        is:           'fort-icon',
        properties:   {
          size: {
            type:     String,
            value:    '24',
            observer: '_sizeChanged'
          },
          src:  String,
          alt:  String
        },
        _type:        '',
        _icon:        '',
        _sizeChanged: function ()
                      {
                        // remove any non-numeric characters, ready to append px for styles
                        this.size = this.size.replace(/\D/g, '');

                        this.customStyle['--fort-icon-size'] = this.size + 'px';
                        this.updateStyles();
                      },
        _isType:      function (type)
                      {
                        if(!this._type)
                        {
                          if(this.getEffectiveChildren().length == 0)
                          {
                            var content = this.getEffectiveTextContent().trim();
                            var match = content.match(/^(iron|material):(.+)$/);
                            if(match)
                            {
                              this._type = match[1];
                              this._icon = match[2];
                            }
                            else
                            {
                              this._type = 'url';
                              this._icon = content;
                            }
                          }
                          else
                          {
                            this._type = 'svg';
                            // strip width/height from svg to allow it to scale to [[size]]
                            this._icon = this.queryEffectiveChildren('svg');
                            if(this._icon)
                            {
                              this._icon.style.width = '100%';
                              this._icon.style.height = '100%';

                              if(this._icon.hasAttribute('width'))
                              {
                                this._icon.removeAttribute('width');
                              }

                              if(this._icon.hasAttribute('height'))
                              {
                                this._icon.removeAttribute('height');
                              }
                            }
                          }

                          if(this._type == 'iron')
                          {
                            var iconSplit = this._icon.split(':');
                            var iconGroup = iconSplit[0] == 'icons' ? 'iron' : iconSplit[0];
                            this.importHref(this.resolveUrl('../iron-icons/' + iconGroup + '-icons.html'));
                          }

                          if(this._type == 'material')
                          {
                            this.importHref(this.resolveUrl('material-icons.html'));
                          }
                        }

                        return this._type == type;
                      }
      }
    );
  </script>
</dom-module>
